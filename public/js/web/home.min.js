var finalFiles={};function openFileChooser(){$("#previewMedia").children("div").length<3?$("#file").click():ShowMessageModal("Maximum 3 Photoes Allowed","You can add maximum 3 photoes.")}function openAddYoutubeVideoModal(){$("#add_youtube_video").modal("show")}function AddYouTubeVideo(){var e=$("#youtube_url").val();if(null!=e||""!=e){var i=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/);if(i&&11==i[2].length){var t=getParameterByName("v",e),o='<div class="col-12"><iframe width="496" height="280" src="'+("https://www.youtube.com/embed/"+t)+'" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>';$("#type").val("YOUTUBE"),$("#cover").val(t),$("#previewMedia").empty(),$("#previewMedia").append(o),$("#previewMedia").css("display","block"),$("#add_youtube_video").modal("hide"),$("#youtube_url").val("")}else ShowMessageModal("Invalid URL","Please add valid youtube video URL.")}}function openAddEmbedCodeModal(){$("#add_embed_code").modal("show")}function AddEmbedCode(){var e=$("#embed-code").val();console.log(e);var i=new RegExp("(?:<iframe[^>]*)(?:(?:/>)|(?:>.*?</iframe>))","g"),t=new RegExp("(?:<script[^>]*)(?:(?:/>)|(?:>.*?<\/script>))","g");if(e.length>0&&(i.test(e)||t.test(e))){$("#type").val("EMBED"),$("#cover").val(e),$("#previewMedia").empty(),$("#previewMedia").append('<iframe id="preview-embed" width="100%" height="100%"  style="min-height:500px;width:100%;height:100%;" frameBorder="0" scrolling="yes"></iframe>'),$("#preview-embed").ready(function(){iframeDoc=document.getElementById("preview-embed").contentDocument,iframeDoc.open(),iframeDoc.write(e),iframeDoc.close()}),$("#previewMedia").css("display","block"),$("#add_embed_code").modal("hide"),$("#embed-code").val("")}else ShowMessageModal("Invalid Embed Code","Please add valid embed code.")}function postOpinion(){if("IMAGE"==$("#type").val()){var e=[];$.each(finalFiles,function(i,t){e.push(t.name)});var i=e.join(",");$("#cover").val(i),$("#opinion_form").submit()}else $("#opinion_form").submit()}function getHashTags(e){return e.match(/#\S+/g)}function submitOpinion(){var e=getHashTags($("#write_opinion").val().trim());if(e&&e.length>0){for(var i=[],t=0;t<e.length;t++)e[t].length<4?(i.push(0),ShowMessageModal("Please Enter Valid #Thread ","Please enter valid thread by typing # of minimum 3 characters.")):i.push(1);if(!i.includes(0))if("IMAGE"==$("#type").val()){var o=[];$.each(finalFiles,function(e,i){o.push(i.name)});var a=o.join(",");$("#cover").val(a),$("#write_thread").submit()}else $("#write_thread").submit()}else ShowMessageModal("Please Enter Valid #Thread ","Please enter valid thread by typing # of minimum 3 characters.")}
function manageFollow(e,i){var t=$("input[name=_token]").val();$.ajax({url:"/me/manage_follow",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",data:{_token:t,userid:e},dataType:"json",success:function(t){$(i).removeAttr("disabled"),"unfollowed"==t.status?($(".followingbtn_"+e).css("display","none"),$(".followbtn_"+e).css("display","inline")):($(".followbtn_"+e).css("display","none"),$(".followingbtn_"+e).css("display","inline"))},error:function(e){$(i).removeAttr("disabled")}})}$(document).on("change","#file",function(e){finalFiles={},i=0;var t=e.target.files;$("#file")[0].files.length>3?ShowMessageModal("Maximum 3 Photoes Allowed","You are not allowed to add more than 3 photoes."):("GIF"!=$("#type").val()&&"YOUTUBE"!=$("#type").val()||$("#previewMedia").empty(),$("#previewMedia").css("display",""),$("#type").val("IMAGE"),$.each(t,function(e,i){finalFiles[e]=i;var t=new FileReader;t.onload=function(i){var t='<div class="col-lg-4 col-sm-6 col-12"  id="file_'+e+'"><div class="card mb-2"><img src="'+i.target.result+'" style="height:150px;" class="rounded"><div class="card-img-overlay p-0"><button type="button" class="deleteFile btn btn-sm float-right text-white bg-danger py-1 px-2 rounded" aria-label="Close"><i class="fas fa-times"></i></button></div></div></div>';$("#previewMedia").append(t)},t.readAsDataURL(i)}))}),$(document).on("click",".deleteFile",function(){var e=$(this).parents().get(2),i=e.id.split("_")[1];e.remove(),delete finalFiles[i]}),$(document).on("click","#btn_post",function(){0==au?openLoginModal():(1==au&&1==cev&&0==cmv&&(0==ev?openVerifyEmailMobileModal(verification[0].title,verification[0].text,verification[0].buttons):postOpinion()),1==au&&0==cev&&1==cmv&&(0==mv?openVerifyEmailMobileModal(verification[1].title,verification[1].text,verification[1].buttons):postOpinion()),1==au&&1==cev&&1==cmv&&(0==mv&&0==ev&&openVerifyEmailMobileModal(verification[2].title,verification[2].text,verification[2].buttons),1==mv&&0==ev&&openVerifyEmailMobileModal(verification[0].title,verification[0].text,verification[0].buttons),0==mv&&1==ev&&openVerifyEmailMobileModal(verification[1].title,verification[1].text,verification[1].buttons),1==mv&&1==ev&&postOpinion()))}),$(document).on("click","#btn_submit_opinion",function(){0==au?openLoginModal():(1==au&&1==cev&&0==cmv&&(0==ev?openVerifyEmailMobileModal(verification[0].title,verification[0].text,verification[0].buttons):submitOpinion()),1==au&&0==cev&&1==cmv&&(0==mv?openVerifyEmailMobileModal(verification[1].title,verification[1].text,verification[1].buttons):submitOpinion()),1==au&&1==cev&&1==cmv&&(0==mv&&0==ev&&openVerifyEmailMobileModal(verification[2].title,verification[2].text,verification[2].buttons),1==mv&&0==ev&&openVerifyEmailMobileModal(verification[0].title,verification[0].text,verification[0].buttons),0==mv&&1==ev&&openVerifyEmailMobileModal(verification[1].title,verification[1].text,verification[1].buttons),1==mv&&1==ev&&submitOpinion()))}),$(document).on("click",".like_thread",function(){var e=$(this).attr("data-thread"),i=parseInt($("#thread_likes_count").text());$.ajax({url:"/thread/like",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",data:{id:e},dataType:"json",success:function(t){"liked"==t.status?($(".like_thread_off_"+e).css("display","none"),$(".like_thread_on_"+e).css("display","inline"),i+=1,$("#thread_likes_count").text(i)):($(".like_thread_off_"+e).css("display","inline"),$(".like_thread_on_"+e).css("display","none"),i-=1,$("#thread_likes_count").text(i))},error:function(e){}})}),$(document).on("click",".follow_thread",function(){var e=$(this).attr("data-thread"),i=parseInt($("#thread_followers_count").text());$.ajax({url:"/opinion/thread/follow",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",data:{id:e},dataType:"json",success:function(t){"followed"==t.status?($(".follow_thread_off_"+e).css("display","none"),$(".follow_thread_on_"+e).css("display","inline"),i+=1,$("#thread_followers_count").text(i)):($(".follow_thread_off_"+e).css("display","inline"),$(".follow_thread_on_"+e).css("display","none"),i-=1,$("#thread_followers_count").text(i))},error:function(e){}})}),$(document).on("click",".delete",function(){var e=$(this).attr("id").slice(7);$("#delete_id").val(e),$("#deleteMyOpinion").modal("show")}),$(document).on("click",".finaldelete",function(){var e=$("#delete_id").val();$.ajax({url:"/delete_opinion",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",data:{deleteid:e,_method:"DELETE"},dataType:"json",success:function(i){"success"==i.status&&($("#opinion_"+e).remove(),$("#deleteMyOpinion").modal("hide"))},error:function(e){$("#deleteMyOpinion").modal("hide")}})}),$(document).on("click",".followbtn",function(){0==au?openLoginModal():(userid=$(this).attr("data-userid"),button=".followbtn_"+userid,$(button).attr("disabled","disabled"),manageFollow(userid,button))}),$(document).on("click",".followingbtn",function(){0==au?openLoginModal():(userid=$(this).attr("data-userid"),button=".followingbtn_"+userid,manageFollow(userid,button))});